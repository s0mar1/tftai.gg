# TFT Set 14 → Set 15 MongoDB 데이터 정리 계획

## 📊 현재 상태 분석 (2025-07-30)

### ✅ 백업 완료된 데이터
```
/mongodb-backups/2025-07-30/
├── deckguides-backup.json      (2개 문서)
├── rankers-backup.json         (101개 문서)  
├── decktiers-backup.json       (295개 문서) ⚠️ Set 14 덱 데이터
├── matches-backup.json         (1,169개 문서) ⚠️ Set 14 매치 데이터
├── summonerdatas-backup.json   (2개 문서)
└── data-analysis.json          (전체 분석 결과)
```

### 🎯 정리가 필요한 컬렉션

#### 1. **decktiers** (295개 문서) - **완전 삭제 필요**
- **이유**: Set 14 기반 덱 구성 데이터
- **내용**: 챔피언, 특성, 아이템 조합이 Set 14 기준
- **작업**: 전체 컬렉션 Drop 후 새로 구축

#### 2. **matches** (1,169개 문서) - **완전 삭제 필요**  
- **이유**: Set 14 기반 게임 매치 데이터
- **내용**: 실제 게임 결과, 챔피언/아이템 사용 통계
- **작업**: 전체 컬렉션 Drop 후 Set 15 매치부터 새로 수집

#### 3. **deckguides** (2개 문서) - **검토 후 삭제**
- **이유**: Set 14 챔피언 이름 포함 (사일러스, 세라핀, 베인)
- **작업**: 내용 확인 후 Set 14 관련이면 삭제

#### 4. **rankers** (101개 문서) - **보존**
- **이유**: 랭커 정보는 시즌과 무관한 플레이어 데이터
- **작업**: 보존 (Set 15에서도 동일한 랭커들 추적 가능)

#### 5. **summonerdatas** (2개 문서) - **보존**
- **이유**: 소환사 기본 정보는 시즌과 무관
- **작업**: 보존

### 🚨 즉시 실행 가능한 정리 작업

## Phase 1: 핵심 Set 14 데이터 정리
```sql
// 1. Set 14 덱 데이터 완전 삭제
db.decktiers.drop()

// 2. Set 14 매치 데이터 완전 삭제  
db.matches.drop()

// 3. Set 14 덱 가이드 삭제 (확인 후)
db.deckguides.drop()
```

## Phase 2: Set 15 데이터 구조 준비
```sql
// 1. 빈 컬렉션들 인덱스 재구성
db.traitstats.createIndex({ traitId: 1 }, { unique: true })
db.itemstats.createIndex({ itemId: 1 }, { unique: true })
db.userdecks.createIndex({ deckName: 1, authorPuuid: 1 })

// 2. 새로운 Set 15 전용 컬렉션 생성 (필요시)
db.createCollection("set15_features")  // Power Snax, Unit Roles 등
```

## Phase 3: Set 15 데이터 수집 및 구축
1. **TFT API에서 Set 15 정적 데이터 수집**
   - 챔피언, 특성, 아이템 정보
   - Power Snax 시스템 데이터
   - Unit Roles 시스템 데이터

2. **랭크 게임 매치 데이터 수집**
   - Set 15 기준 새로운 매치 데이터
   - 챔피언/특성/아이템 사용률 통계

3. **메타 덱 분석 및 티어리스트 구축**
   - Set 15 기준 새로운 덱 조합 분석
   - AI 기반 메타 분석

## 🎯 실행 순서

### 1단계: 데이터 안전성 확인 ✅
- [x] 백업 파일 생성 완료
- [x] 백업 파일 무결성 확인

### 2단계: Set 14 데이터 정리 
- [ ] decktiers 컬렉션 삭제
- [ ] matches 컬렉션 삭제  
- [ ] deckguides 컬렉션 검토 및 삭제

### 3단계: Set 15 환경 구축
- [ ] 새로운 인덱스 생성
- [ ] Set 15 정적 데이터 로드
- [ ] API 엔드포인트 Set 15 연동 확인

### 4단계: 데이터 수집 재시작
- [ ] Set 15 매치 데이터 수집 시작
- [ ] Set 15 메타 분석 시작

## 🚨 주의사항

1. **백업 확인**: 실행 전 백업 파일 무결성 재확인
2. **서비스 중단**: 데이터 정리 중 일시적 서비스 중단 가능
3. **롤백 준비**: 문제 발생 시 백업에서 복원 가능하도록 준비
4. **점진적 실행**: 한 번에 모든 컬렉션을 삭제하지 말고 단계별 실행

## 📋 실행 체크리스트

### 실행 전 확인사항
- [ ] 백업 파일 존재 확인
- [ ] 백업 파일 크기 확인 (비어있지 않음)
- [ ] MongoDB 연결 상태 확인
- [ ] 서비스 중단 공지 (필요시)

### 실행 후 확인사항  
- [ ] 삭제된 컬렉션 확인
- [ ] 보존된 데이터 무결성 확인
- [ ] Set 15 API 정상 동작 확인
- [ ] 새로운 데이터 수집 시작 확인

---

**⚠️ 중요**: 이 작업은 되돌릴 수 없습니다. 반드시 백업을 확인한 후 실행하세요.